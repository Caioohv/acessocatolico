import{h as c,J as u}from"./wPnuorX7.js";const A=()=>{const s=c(!1),r=c(null),y=async a=>{var n;s.value=!0,r.value=null;try{const e=await $fetch("/api/events",{method:"POST",body:a});return{success:e.success,event:e.event,message:e.message}}catch(e){const t=((n=e.data)==null?void 0:n.message)||e.message||"Erro ao criar evento";throw r.value=t,new Error(t)}finally{s.value=!1}},E=async(a,n)=>{var e;s.value=!0,r.value=null;try{const t=await $fetch(`/api/events/${a}`,{method:"PUT",body:n});return{success:t.success,event:t.event,message:t.message}}catch(t){const o=((e=t.data)==null?void 0:e.message)||t.message||"Erro ao atualizar evento";throw r.value=o,new Error(o)}finally{s.value=!1}},w=async a=>{var n;s.value=!0,r.value=null;try{const e=new URLSearchParams;a!=null&&a.page&&e.append("page",a.page.toString()),a!=null&&a.limit&&e.append("limit",a.limit.toString()),a!=null&&a.search&&e.append("search",a.search),a!=null&&a.category&&e.append("category",a.category),a!=null&&a.status&&e.append("status",a.status),a!=null&&a.organizerId&&e.append("organizerId",a.organizerId),a!=null&&a.parishId&&e.append("parishId",a.parishId),a!=null&&a.cityId&&e.append("cityId",a.cityId),a!=null&&a.startDate&&e.append("startDate",a.startDate),a!=null&&a.endDate&&e.append("endDate",a.endDate),(a==null?void 0:a.isPublic)!==void 0&&e.append("isPublic",a.isPublic.toString()),(a==null?void 0:a.isFeatured)!==void 0&&e.append("isFeatured",a.isFeatured.toString());const t="/api/events"+(e.toString()?`?${e.toString()}`:""),o=await $fetch(t);return l.value=o.data.events,m.value=o.data.pagination.total,h.value=o.data.pagination.pages,o.data}catch(e){const t=((n=e.data)==null?void 0:n.message)||e.message||"Erro ao buscar eventos";throw r.value=t,new Error(t)}finally{s.value=!1}},D=async a=>{var n;s.value=!0,r.value=null;try{const e=await $fetch(`/api/events/${a}`);return d.value=e.data,v.value=e.data.registrationCount||0,g.value=e.data.userRegistration||null,e.data}catch(e){if(e.status===404)return d.value=null,null;const t=((n=e.data)==null?void 0:n.message)||e.message||"Erro ao buscar evento";throw r.value=t,new Error(t)}finally{s.value=!1}},P=async a=>{var n;s.value=!0,r.value=null;try{return await $fetch(`/api/events/${a}`,{method:"DELETE"})}catch(e){const t=((n=e.data)==null?void 0:n.message)||e.message||"Erro ao excluir evento";throw r.value=t,new Error(t)}finally{s.value=!1}},S=async(a,n)=>{var e;s.value=!0,r.value=null;try{const t=new FormData;return t.append("eventId",a),t.append("file",n),await $fetch("/api/events/upload-cover",{method:"POST",body:t})}catch(t){const o=((e=t.data)==null?void 0:e.message)||t.message||"Erro ao enviar imagem";throw r.value=o,new Error(o)}finally{s.value=!1}},$=async(a,n)=>{var e;s.value=!0,r.value=null;try{const t=new FormData;return t.append("eventId",a),n.forEach((z,U)=>{t.append("files",z)}),await $fetch("/api/events/upload-gallery",{method:"POST",body:t})}catch(t){const o=((e=t.data)==null?void 0:e.message)||t.message||"Erro ao enviar imagens";throw r.value=o,new Error(o)}finally{s.value=!1}},C=async()=>{try{const a=await $fetch("/api/events/categories");return p.value=a.data,a.data}catch(a){return console.error("Error fetching categories:",a),p.value=[],[]}},I=a=>a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim().substring(0,50),T=a=>({DRAFT:"Rascunho",PUBLISHED:"Publicado",CANCELLED:"Cancelado",COMPLETED:"Concluído"})[a]||a,b=a=>({DRAFT:"gray",PUBLISHED:"green",CANCELLED:"red",COMPLETED:"blue"})[a]||"gray",L=a=>{var o;const n=new Date,e=a.registrationStart?new Date(a.registrationStart):new Date(a.createdAt),t=a.registrationEnd?new Date(a.registrationEnd):new Date(a.startDate);return a.registrationRequired&&a.status==="PUBLISHED"&&n>=e&&n<=t&&(!a.maxParticipants||(((o=a._count)==null?void 0:o.registrations)||0)<a.maxParticipants)},M=a=>{const n=new Date,t=new Date(a.startDate).getTime()-n.getTime();return Math.ceil(t/(1e3*60*60*24))},F=async a=>{var n;try{s.value=!0;const e=await $fetch(`/api/events/${a}/register`,{method:"POST"});return g.value=e.data,e.data}catch(e){throw r.value=((n=e.data)==null?void 0:n.message)||"Erro ao se inscrever no evento",e}finally{s.value=!1}},R=async a=>{var n;try{const e=await $fetch(`/api/events/${a}/comments`);return i.value=e.data||[],e.data}catch(e){throw r.value=((n=e.data)==null?void 0:n.message)||"Erro ao carregar comentários",e}},O=async(a,n)=>{var e;try{return(await $fetch(`/api/events/${a}/comments`,{method:"POST",body:{content:n}})).data}catch(t){throw r.value=((e=t.data)==null?void 0:e.message)||"Erro ao adicionar comentário",t}},d=c(null),g=c(null),v=c(0),i=c([]),l=c([]),p=c([]),m=c(0),h=c(0);return{event:u(d),events:u(l),categories:u(p),userRegistration:u(g),registrationCount:u(v),comments:u(i),totalEvents:u(m),totalPages:u(h),loading:u(s),error:u(r),createEvent:y,updateEvent:E,getEvents:w,getEvent:D,deleteEvent:P,uploadCoverImage:S,uploadGalleryImages:$,getCategories:C,registerForEvent:F,getEventComments:R,addEventComment:O,generateSlug:I,formatStatus:T,getStatusColor:b,isRegistrationOpen:L,getDaysUntilEvent:M}};export{A as u};
