import xe from"./DcD60dw0.js";import{_ as be}from"./C4sSfo7S.js";import{a as ye}from"./BtdOvfXc.js";import{_ as we}from"./Bd5iK0Qo.js";import{_ as Ee}from"./D6cRczWY.js";import{_ as ke}from"./qKtb0dX2.js";import{_ as Ce}from"./CWNVVxTE.js";import{_ as De}from"./B3ORKnUs.js";import{_ as $e}from"./D1kZC3JJ.js";import{_ as Pe}from"./B1s7ovIT.js";import{_ as Se}from"./bOSK1H7f.js";import{H as Te,D as A,h as f,f as U,G as Ve,s as Ae,c as E,a as t,b as a,w as p,l as o,t as u,k as q,F as H,B as K,A as Ie,i as Q,o as h,d as x,C as Ue,j as Re}from"./wPnuorX7.js";import{u as Ne}from"./Ba4-aC7x.js";import"./CMLLu8c2.js";import"./CQ8b8sfu.js";import"./CryAMGYs.js";import"./Dm6-dgtR.js";import"./BKhI9f09.js";import"./BeGsyJa-.js";import"./Dw2envGg.js";import"./CHIgUVhi.js";import"./Bwuw1Nl5.js";const Le={class:"min-h-screen bg-gray-50"},Fe={class:"bg-white border-b border-gray-200"},Oe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},je={class:"flex items-center justify-between py-6"},Me={class:"flex items-center space-x-4"},Be={class:"border-l border-gray-300 pl-4"},ze={class:"text-sm text-gray-600 mt-1"},Je={class:"flex items-center space-x-3"},Ge={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Xe={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},qe={class:"bg-white rounded-lg border border-gray-200 p-6"},He={class:"flex items-center"},Ke={class:"p-2 bg-blue-100 rounded-lg"},Qe={class:"ml-4"},We={class:"text-2xl font-bold text-gray-900"},Ye={class:"bg-white rounded-lg border border-gray-200 p-6"},Ze={class:"flex items-center"},et={class:"p-2 bg-yellow-100 rounded-lg"},tt={class:"ml-4"},st={class:"text-2xl font-bold text-gray-900"},ot={class:"bg-white rounded-lg border border-gray-200 p-6"},at={class:"flex items-center"},nt={class:"p-2 bg-green-100 rounded-lg"},lt={class:"ml-4"},rt={class:"text-2xl font-bold text-gray-900"},it={class:"bg-white rounded-lg border border-gray-200 p-6"},dt={class:"flex items-center"},ct={class:"p-2 bg-red-100 rounded-lg"},ut={class:"ml-4"},mt={class:"text-2xl font-bold text-gray-900"},pt={class:"bg-white rounded-lg border border-gray-200 p-4 mb-6"},vt={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},gt={class:"md:col-span-2"},_t={class:"flex items-end space-x-2"},ft={key:0,class:"mt-4 pt-4 border-t border-gray-200"},ht={class:"flex items-center justify-between"},xt={class:"text-sm text-gray-600"},bt={class:"flex items-center space-x-2"},yt={class:"bg-white rounded-lg border border-gray-200"},wt={key:0,class:"p-6"},Et={class:"space-y-4"},kt={key:1,class:"text-center py-12"},Ct={class:"text-gray-600 mb-6"},Dt={key:2},$t={class:"bg-gray-50 px-6 py-3 border-b border-gray-200"},Pt={class:"flex items-center space-x-4"},St={class:"divide-y divide-gray-200"},Tt={class:"flex items-center space-x-4"},Vt={class:"grid grid-cols-6 gap-4 w-full"},At={class:"col-span-2"},It={class:"flex items-center space-x-3"},Ut={class:"flex-shrink-0"},Rt={class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center"},Nt={class:"text-sm font-medium text-gray-600"},Lt={class:"min-w-0 flex-1"},Ft={class:"text-sm font-medium text-gray-900 truncate"},Ot={class:"text-sm text-gray-500 truncate"},jt={class:"text-sm text-gray-600"},Mt={class:"text-sm text-gray-600"},Bt={class:"bg-gray-50 px-6 py-3 border-t border-gray-200"},zt={class:"flex items-center justify-between"},Jt={class:"text-sm text-gray-700"},Gt={class:"flex items-center justify-between"},_s={__name:"inscricoes",setup(Xt){const W=Te(),k=A(()=>W.params.eventId),{showToast:C}=Ne(),P=f(!0),S=f(!1),T=f(null),g=f([]),m=f([]),I=f(null),D=f(!1),l=f({search:"",status:"",dateFrom:"",dateTo:""}),c=f({page:1,limit:20,total:0}),$=f({total:0,pending:0,approved:0,rejected:0,incomplete:0}),Y=[{value:"",label:"Todos os status"},{value:"PENDING",label:"Pendente"},{value:"APPROVED",label:"Aprovada"},{value:"REJECTED",label:"Rejeitada"},{value:"INCOMPLETE",label:"Incompleta"}],Z=[[{label:"Exportar como CSV",icon:"heroicons:document-arrow-down",click:()=>L("csv")}],[{label:"Exportar como XLSX",icon:"heroicons:table-cells",click:()=>L("xlsx")}]],ee=A(()=>l.value.search||l.value.status||l.value.dateFrom),R=A(()=>g.value.length>0&&m.value.length===g.value.length),te=A(()=>m.value.length>0&&m.value.length<g.value.length),se=useDebounceFn(()=>{c.value.page=1,b()},300);async function b(){try{P.value=!0;const s=new URLSearchParams({eventId:k.value.toString(),page:c.value.page.toString(),limit:c.value.limit.toString()});l.value.search&&s.append("search",l.value.search),l.value.status&&s.append("status",l.value.status),l.value.dateFrom&&s.append("dateFrom",l.value.dateFrom),l.value.dateTo&&s.append("dateTo",l.value.dateTo);const{auth:e}=U(),n=await $fetch(`/api/admin/submissions?${s}`,{headers:{authorization:`Bearer ${e.value.token}`}});g.value=n.submissions,c.value={...c.value,...n.pagination},$.value={total:n.submissions.length,pending:n.submissions.filter(i=>i.status==="PENDING").length,approved:n.submissions.filter(i=>i.status==="APPROVED").length,rejected:n.submissions.filter(i=>i.status==="REJECTED").length,incomplete:n.submissions.filter(i=>i.status==="INCOMPLETE").length}}catch(s){console.error("Error loading submissions:",s),C("Erro ao carregar inscrições","error")}finally{P.value=!1}}async function oe(){try{const{data:s}=await $fetch(`/api/events/${k.value}`);T.value=s}catch(s){console.error("Error loading event:",s)}}function ae(){R.value?m.value=[]:m.value=g.value.map(s=>s.id)}function ne(s){const e=m.value.indexOf(s);e>=0?m.value.splice(e,1):m.value.push(s)}function le(s){I.value=s,D.value=!0}async function V(s,e,n=""){try{const{success:i}=await $fetch(`/api/forms/submissions/${s}/status`,{method:"PUT",body:{status:e,reason:n}});if(i){const d=g.value.find(v=>v.id===s);d&&(d.status=e,d.updatedAt=new Date().toISOString()),await b(),C(`Inscrição ${F(e).toLowerCase()} com sucesso!`,"success")}}catch(i){console.error("Error updating submission status:",i),C("Erro ao atualizar status da inscrição","error")}}async function N(s){if(m.value.length!==0)try{S.value=!0;const{auth:e}=U(),n=await $fetch("/api/admin/submissions/bulk-update",{method:"PUT",headers:{authorization:`Bearer ${e.value.token}`},body:{submissionIds:m.value,status:s,reason:""}});n.success&&(m.value=[],await b(),C(`${n.updated} inscrições atualizadas!`,"success"))}catch(e){console.error("Error bulk updating submissions:",e),C("Erro ao atualizar inscrições em lote","error")}finally{S.value=!1}}async function L(s){var e;try{const{auth:n}=U(),i=new URLSearchParams({eventId:k.value.toString(),format:s});l.value.search&&i.append("search",l.value.search),l.value.status&&i.append("status",l.value.status),l.value.dateFrom&&i.append("dateFrom",l.value.dateFrom),l.value.dateTo&&i.append("dateTo",l.value.dateTo);const d=await fetch(`/api/admin/events/${k.value}/export?${i}`,{headers:{authorization:`Bearer ${n.value.token}`}});if(!d.ok)throw new Error("Export failed");const v=await d.blob(),y=window.URL.createObjectURL(v),_=document.createElement("a");_.href=y,_.download=`inscricoes-${((e=T.value)==null?void 0:e.title)||k.value}.${s}`,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(y),C("Arquivo exportado com sucesso!","success")}catch(n){console.error("Error exporting submissions:",n),C("Erro ao exportar inscrições","error")}}function re(s){return[[{label:"Ver detalhes",icon:"heroicons:eye",click:()=>le(s)}],[{label:"Aprovar",icon:"heroicons:check-circle",click:()=>V(s.id,"APPROVED"),disabled:s.status==="APPROVED"}],[{label:"Rejeitar",icon:"heroicons:x-circle",click:()=>V(s.id,"REJECTED"),disabled:s.status==="REJECTED"}],[{label:"Marcar como incompleta",icon:"heroicons:exclamation-triangle",click:()=>V(s.id,"INCOMPLETE"),disabled:s.status==="INCOMPLETE"}]]}function ie(s){var n,i;if((n=s.user)!=null&&n.profile)return`${s.user.profile.firstName} ${s.user.profile.lastName}`.trim();const e=(i=s.responses)==null?void 0:i.find(d=>{var v,y,_,w;return((y=(v=d.field)==null?void 0:v.label)==null?void 0:y.toLowerCase().includes("nome"))||((_=d.field)==null?void 0:_.type)==="TEXT"&&((w=d.field)==null?void 0:w.order)===1});return(e==null?void 0:e.value)||"Nome não informado"}function de(s){var n,i;if((n=s.user)!=null&&n.email)return s.user.email;const e=(i=s.responses)==null?void 0:i.find(d=>{var v;return((v=d.field)==null?void 0:v.type)==="EMAIL"});return(e==null?void 0:e.value)||"Email não informado"}function ce(s,e){return s&&e?`${s.charAt(0)}${e.charAt(0)}`.toUpperCase():"??"}function ue(s){return{PENDING:"yellow",APPROVED:"green",REJECTED:"red",INCOMPLETE:"orange"}[s]||"gray"}function F(s){return{PENDING:"Pendente",APPROVED:"Aprovada",REJECTED:"Rejeitada",INCOMPLETE:"Incompleta"}[s]||s}function O(s){return s?new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function me(){b()}function pe(){l.value={search:"",status:"",dateFrom:"",dateTo:""},c.value.page=1,b()}return Ve(()=>[l.value.status,l.value.dateFrom,l.value.dateTo],()=>{c.value.page=1,b()}),Ae(async()=>{await Promise.all([oe(),b()])}),(s,e)=>{var M,B;const n=xe,i=be,d=ye,v=Q("UDropdown"),y=we,_=Ee,w=ke,j=Ce,ve=De,ge=$e,_e=Q("SubmissionDetails"),fe=Pe,he=Se;return h(),E("div",Le,[t("div",Fe,[t("div",Oe,[t("div",je,[t("div",Me,[a(i,{to:`/eventos/${((M=o(T))==null?void 0:M.slug)||o(k)}`,class:"flex items-center text-gray-600 hover:text-blue-600 transition-colors"},{default:p(()=>[a(n,{name:"heroicons:arrow-left",class:"h-5 w-5 mr-2"}),e[10]||(e[10]=x(" Voltar ao evento "))]),_:1,__:[10]},8,["to"]),t("div",Be,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold text-gray-900"}," Inscrições do Evento ",-1)),t("p",ze,u(((B=o(T))==null?void 0:B.title)||"Carregando..."),1)])]),t("div",Je,[a(d,{variant:"outline",color:"gray",onClick:me,loading:o(P)},{default:p(()=>[a(n,{name:"heroicons:arrow-path",class:"h-4 w-4 mr-2"}),e[12]||(e[12]=x(" Atualizar "))]),_:1,__:[12]},8,["loading"]),a(v,{items:Z},{default:p(()=>[a(d,{variant:"outline",color:"blue","trailing-icon":"heroicons:chevron-down-20-solid",disabled:o(g).length===0},{default:p(()=>[a(n,{name:"heroicons:arrow-down-tray",class:"h-4 w-4 mr-2"}),e[13]||(e[13]=x(" Exportar "))]),_:1,__:[13]},8,["disabled"])]),_:1}),a(d,{color:"primary",onClick:e[0]||(e[0]=r=>("navigateTo"in s?s.navigateTo:o(Ue))(`/admin/eventos/${o(k)}/formulario`))},{default:p(()=>[a(n,{name:"heroicons:cog-6-tooth",class:"h-4 w-4 mr-2"}),e[14]||(e[14]=x(" Configurar Formulário "))]),_:1,__:[14]})])])])]),t("div",Ge,[t("div",Xe,[t("div",qe,[t("div",He,[t("div",Ke,[a(n,{name:"heroicons:document-text",class:"h-6 w-6 text-blue-600"})]),t("div",Qe,[e[15]||(e[15]=t("p",{class:"text-sm text-gray-600"},"Total de Inscrições",-1)),t("p",We,u(o($).total),1)])])]),t("div",Ye,[t("div",Ze,[t("div",et,[a(n,{name:"heroicons:clock",class:"h-6 w-6 text-yellow-600"})]),t("div",tt,[e[16]||(e[16]=t("p",{class:"text-sm text-gray-600"},"Pendentes",-1)),t("p",st,u(o($).pending),1)])])]),t("div",ot,[t("div",at,[t("div",nt,[a(n,{name:"heroicons:check-circle",class:"h-6 w-6 text-green-600"})]),t("div",lt,[e[17]||(e[17]=t("p",{class:"text-sm text-gray-600"},"Aprovadas",-1)),t("p",rt,u(o($).approved),1)])])]),t("div",it,[t("div",dt,[t("div",ct,[a(n,{name:"heroicons:x-circle",class:"h-6 w-6 text-red-600"})]),t("div",ut,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-600"},"Rejeitadas",-1)),t("p",mt,u(o($).rejected),1)])])])]),t("div",pt,[t("div",vt,[t("div",gt,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Buscar inscrições ",-1)),a(y,{modelValue:o(l).search,"onUpdate:modelValue":e[1]||(e[1]=r=>o(l).search=r),placeholder:"Nome, email, respostas...",icon:"heroicons:magnifying-glass",onInput:o(se)},null,8,["modelValue","onInput"])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Status ",-1)),a(_,{modelValue:o(l).status,"onUpdate:modelValue":e[2]||(e[2]=r=>o(l).status=r),options:Y,placeholder:"Todos os status"},null,8,["modelValue"])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Data de inscrição ",-1)),a(y,{modelValue:o(l).dateFrom,"onUpdate:modelValue":e[3]||(e[3]=r=>o(l).dateFrom=r),type:"date",placeholder:"De"},null,8,["modelValue"])]),t("div",_t,[a(d,{variant:"outline",color:"gray",onClick:pe,class:"flex-1"},{default:p(()=>[a(n,{name:"heroicons:x-mark",class:"h-4 w-4 mr-2"}),e[22]||(e[22]=x(" Limpar "))]),_:1,__:[22]})])]),o(m).length>0?(h(),E("div",ft,[t("div",ht,[t("div",xt,u(o(m).length)+" inscrições selecionadas ",1),t("div",bt,[a(d,{variant:"outline",color:"green",size:"sm",onClick:e[4]||(e[4]=r=>N("APPROVED")),loading:o(S)},{default:p(()=>[a(n,{name:"heroicons:check",class:"h-4 w-4 mr-1"}),e[23]||(e[23]=x(" Aprovar selecionadas "))]),_:1,__:[23]},8,["loading"]),a(d,{variant:"outline",color:"red",size:"sm",onClick:e[5]||(e[5]=r=>N("REJECTED")),loading:o(S)},{default:p(()=>[a(n,{name:"heroicons:x-mark",class:"h-4 w-4 mr-1"}),e[24]||(e[24]=x(" Rejeitar selecionadas "))]),_:1,__:[24]},8,["loading"])])])])):q("",!0)]),t("div",yt,[o(P)&&o(g).length===0?(h(),E("div",wt,[t("div",Et,[(h(),E(H,null,K(5,r=>t("div",{key:r,class:"flex items-center space-x-4"},[a(w,{class:"h-4 w-4"}),a(w,{class:"h-4 w-1/4"}),a(w,{class:"h-4 w-1/6"}),a(w,{class:"h-4 w-1/6"}),a(w,{class:"h-4 w-1/6"})])),64))])])):o(g).length===0?(h(),E("div",kt,[a(n,{name:"heroicons:inbox",class:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e[25]||(e[25]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Nenhuma inscrição encontrada",-1)),t("p",Ct,u(o(ee)?"Tente ajustar os filtros de busca":"Ainda não há inscrições para este evento"),1)])):(h(),E("div",Dt,[t("div",$t,[t("div",Pt,[a(j,{checked:o(R),indeterminate:o(te),onChange:ae},null,8,["checked","indeterminate"]),e[26]||(e[26]=t("div",{class:"grid grid-cols-6 gap-4 w-full text-xs font-medium text-gray-500 uppercase tracking-wider"},[t("div",{class:"col-span-2"},"Participante"),t("div",null,"Status"),t("div",null,"Data de Inscrição"),t("div",null,"Última Atualização"),t("div",null,"Ações")],-1))])]),t("div",St,[(h(!0),E(H,null,K(o(g),r=>{var z,J,G,X;return h(),E("div",{key:r.id,class:"px-6 py-4 hover:bg-gray-50 transition-colors"},[t("div",Tt,[a(j,{checked:o(m).includes(r.id),onChange:qt=>ne(r.id)},null,8,["checked","onChange"]),t("div",Vt,[t("div",At,[t("div",It,[t("div",Ut,[t("div",Rt,[t("span",Nt,u(ce((J=(z=r.user)==null?void 0:z.profile)==null?void 0:J.firstName,(X=(G=r.user)==null?void 0:G.profile)==null?void 0:X.lastName)),1)])]),t("div",Lt,[t("p",Ft,u(ie(r)),1),t("p",Ot,u(de(r)),1)])])]),t("div",null,[a(ve,{color:ue(r.status),variant:"subtle"},{default:p(()=>[x(u(F(r.status)),1)]),_:2},1032,["color"])]),t("div",jt,u(O(r.submittedAt)),1),t("div",Mt,u(O(r.updatedAt)),1),t("div",null,[a(v,{items:re(r)},{default:p(()=>[a(d,{variant:"ghost",color:"gray","trailing-icon":"heroicons:chevron-down-20-solid",size:"sm"},{default:p(()=>e[27]||(e[27]=[x(" Ações ")])),_:1,__:[27]})]),_:2},1032,["items"])])])])])}),128))]),t("div",Bt,[t("div",zt,[t("div",Jt," Mostrando "+u((o(c).page-1)*o(c).limit+1)+" até "+u(Math.min(o(c).page*o(c).limit,o(c).total))+" de "+u(o(c).total)+" inscrições ",1),a(ge,{modelValue:o(c).page,"onUpdate:modelValue":[e[6]||(e[6]=r=>o(c).page=r),b],"page-count":o(c).limit,total:o(c).total},null,8,["modelValue","page-count","total"])])])]))])]),a(he,{modelValue:o(D),"onUpdate:modelValue":e[9]||(e[9]=r=>Ie(D)?D.value=r:null),ui:{width:"max-w-4xl"}},{default:p(()=>[a(fe,null,{header:p(()=>[t("div",Gt,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold"},"Detalhes da Inscrição",-1)),a(d,{color:"gray",variant:"ghost",icon:"heroicons:x-mark-20-solid",onClick:e[7]||(e[7]=r=>D.value=!1)})])]),default:p(()=>[o(I)?(h(),Re(_e,{key:0,submission:o(I),onUpdateStatus:V,onClose:e[8]||(e[8]=r=>D.value=!1)},null,8,["submission"])):q("",!0)]),_:1})]),_:1},8,["modelValue"])])}}};export{_s as default};
